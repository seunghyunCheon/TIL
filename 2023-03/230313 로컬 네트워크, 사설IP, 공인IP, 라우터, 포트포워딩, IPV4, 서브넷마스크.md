230313 로컬 네트워크, 사설IP, 공인IP, 라우터, 포트포워딩, IPV4, 서브넷마스크
===
학습내용
---
- TCP/IP관련 용어 학습


## TCP/IP관련 용어 학습

컴퓨터와 컴퓨터가 서로 데이터를 전송하려면 ISP(Internet Service Provider)로부터 인터넷 서비스를 제공받아야 하고, 각 컴퓨터의 주소를 알고있어야 한다. 

전세계의 컴퓨터, 핸드폰수는 어림잡아 전세계 인구가 1개씩만 가지고 있다고해도 160억이다. 

**그럼 각 컴퓨터는 160억개의 주소를 갖고있을까?** 아니다

IPV4의 경우 32비트의 주소체계를 가지고있기 때문에 2의 32으로 32억개정도이다. 

이 수많은 IP를 감당하기 위해 IPV6프로토콜을 사용하기도 하지만 그 이전에 IPV4로 해결할 수 있는 방법이 존재해왔고 그걸 사용해왔다.

로컬 네트워크를 이용하는 것이다. 

집에 있는 공유기를 살펴보면 통신사에서 제공하는 IP가 있는데 이게 **공인IP**이다. 
그리고 이 공인IP를 이용해 네트워크를 만들어서 장치마다 새로운 IP를 부여해준 것이 **사설IP**이다. 

그렇다면 사설망안에 있는 컴퓨터는 어떻게 외부와 통신할까?
외부 인터넷 입장에서는 주소 번호가 똑같은 사설 IP들일 뿐인데 말이다. 

이를 위해 사용하는 것이 NAT(Network Address Translation)이다.

<img src="https://i.imgur.com/NwGmNzh.png" width="600"/>


우리집의 경우 KT에서 공인IP를 제공받은 공유기가 하나있다. 이 공유기의 공유IP를 기반으로 192.168.~.~ 형태의 사설IP를 제공한다.

내 맥북의 경우 공유기와 연결된 설정이 다음과 같다.

<img src="https://i.imgur.com/dgj9rft.png" width="500"/><br/>

서브넷 마스크는 IP 주소의 네트워크 부분을 마스킹하여 네트워크 부분과 호스트 부분을 구분할 수 있게 만드는 비트이다. 

192.168.0.7의 IP에 서브넷 마스크가 255.255.255.0이라면 각 옥텟(.으로 구분되는 비트들)에 맞는 192.168.0 부분이 네트워크 주소가 되고 7이 호스트 주소가 된다.

즉 192.168.0 로컬 네트워크를 사용하고 7번장치를 의미하는 것이다. 내 맥북은 끝이 7, 다른노트북은8, 핸드폰은5이다.

DHCP는 Dynamic Host Configuration Protocol의 약자로 자동으로 IP주소, 서브넷 마스크, 기본 게이트웨이 등의 기타 관련된 구성 정보를 제공하는 클라이언트/서버 프로토콜이다. 

### DHCP를 사용하는 이유는 무엇일까

모든 디바이스는 TCP 기반 네트워크에서 네트워크 및 해당 리소스에 엑세스하는 고유한 유니캐스트 IP 주소가 있어야 한다. DHCP를 하지 않는다면 모든 기기에 IP를 수동으로 구성해야 한다. 

하지만 DHCP를 이용하면 DHCP서버가 알아서 관리를 해주고 자동화하기 때문에 IP가 중복해서 선언되는 일이 없다.(DHCP서버 내 IP 주소 풀을 유지 관리하기 때문에)

### DHCP의 이점은?
- 신뢰할 수 있는 IP주소 구성을 한다. 수동으로 인한 오류를 최소화한다.
- 네트워크 관리를 감소한다.
    - 중앙에서 자동화 된 TCP/IP를 구성한다.
    - DHCP 옵션을 사용해 TCP/IP 구성 값의 전체 범위를 지정할 수 있다.
    - 무선 네트워크에서 다른 위치로 이동하는 휴대용 디바이스와 같은 자주 업데이트하는 클라이언트의 IP주소를 효과적으로 변경한다.

### 포트포워딩

포트포워딩은 포트(Port)를 전달(Forwading)하는 것으로 특정한 포트로 들어오는 데이터 패킷을 다른 포트로 바꿔서 다시 전송해주는 작업이다.

이러한 방식으로 포트포워딩은 수신 데이터가 NAT 방화벽을 우회하도록 하여 인터넷 연결 속도를 개선한다. 그리고 원격으로 기기에 액세스하도록 도와줄 수 있다.

이렇게 좋은 포트포워딩에게도 치명적인 단점이 있다. 특정 포트번호가 열려있는 것이기 때문에 해커가 DNS와 포트번호를 입력해서 들어온 뒤 허술한 비밀번호를 해킹할 수도 있는 것이다.

#### 포트포워딩 원리

라우터는 사설 네트워크를 구축하고 공용 IP를 할당받는다고 위에서 얘기했다. 이때 라우터에 연결된 기기는 인터넷에 접속하기 위해서는 무조건 라우터를 거쳐야 한다. 그런데 가정용 기기를 원격 기기에 직접 연결하고 싶다면 서버 포트포워딩을 설정해야 한다. 

라우터에는 6만 개 이상의 포트가 있는데, 이중 1000개의 포트를 표준에 이용이 되며 나머지 포트는 원하는 기기나 프로그램에 할당할 수 있다. 이러한 방식으로 라우터에 있는 포트를 열어 특정 기기에 할당할 수 있다.


#### 포트포워딩 목적

가정용 네트워크와 원격 기기 사이를 직접 연결하는 경유 유리하다.
- 원격으로 가정용 서버에 연결하는 경우
- 스마트홈 기기를 가정용 네트워크에 연결하는 경우
- 게임 서버에 직접적으로 연결하는 경우
- 외출 시 가정용 CCTV를 모니터링하는 경우



### 참고자료
- [IP, NAT](https://inpa.tistory.com/entry/WEB-%F0%9F%8C%90-IP-%EA%B8%B0%EC%B4%88-%EC%82%AC%EC%84%A4IP-%EA%B3%B5%EC%9D%B8IP-NAT-%EA%B0%9C%EB%85%90-%EC%A0%95%EB%A7%90-%EC%89%BD%EA%B2%8C-%EC%A0%95%EB%A6%AC#nat_%EC%82%AC%EC%84%A4%EB%A7%9D_%E2%86%94_%EC%99%B8%EB%B6%80_%ED%86%B5%EC%8B%A0_%EB%B0%A9%EB%B2%95)
- [DHCP](https://learn.microsoft.com/ko-kr/windows-server/networking/technologies/dhcp/dhcp-top)
- [포트포워딩](https://nordvpn.com/ko/blog/port-forwarding-vpn/)
